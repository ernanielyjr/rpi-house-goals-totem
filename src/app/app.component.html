<div *ngIf="loading" class="loading" [@enterAnimation]>loading...</div>

<div class="progress timer">
  <div class="progress-bar bg-success" [ngStyle]="{ 'width': countdownPercent + '%' }"></div>
</div>

<div class="container-fluid">
  <h1>Meta de Despesas</h1>
  <h3 class="text-center">
    <a class="btn btn-sm btn-outline-info" href="javascript:void(0);" (click)="prevMonth()">&larr;</a>
    {{ currentMonth }}
    <a class="btn btn-sm btn-outline-info" href="javascript:void(0);" (click)="nextMonth()">&rarr;</a>
  </h3>

  <div class="main">
    <ul class="budget-list clearfix">
      <li *ngIf="dayProgress && budgets && budgets.length" class="day-progress" [ngStyle]="{ 'left': dayProgress + '%' }">
        <div class="today">HOJE</div>
      </li>

      <li *ngFor="let budget of budgets" class="budget" [class.total]="budget.id === 0" [class.selected]="!selectedBudget || budget.id === selectedBudget.id || selectedBudget.id === 0" (click)="showTransactions(budget)">
        <article>
          <header>
            <h2>{{ budget.category_name }}</h2>
            <h3>{{ budget.amount | number:'1.2-2' }}</h3>
          </header>
          <div class="progress">
            <div class="progress-bar" [ngStyle]="{ 'width': budget.percentage + '%', 'background-color': '#' + budget.category_color }"></div>
            <div class="infos">
              <div class="used">{{ budget.totalUsed | number:'1.2-2' }}</div>
              <div class="remaining">{{ budget.amount - budget.totalUsed | number:'1.2-2' }}</div>
            </div>
          </div>
        </article>
      </li>
    </ul>

    <div class="transactions-list" [class.two-columns]="!selectedBudget || selectedBudget.id === 0">
      <div class="text-center mb-3" *ngIf="selectedBudget && selectedBudget.id !== 0">
        <div class="badge badge-info">
          Meta prevista:
          R$ {{ selectedBudget.amount | number:'1.2-2' }}
        </div>
        &nbsp;
        <div class="badge badge-warning">
          Total gasto:
          R$ {{ selectedBudget.totalUsed | number:'1.2-2' }}
        </div>
        &nbsp;
        <div class="badge" [class.badge-success]="selectedBudget.amount >= selectedBudget.totalUsed" [class.badge-danger]="selectedBudget.amount < selectedBudget.totalUsed">
          Valor restante:
          R$ {{ selectedBudget.amount - selectedBudget.totalUsed | number:'1.2-2' }}
        </div>
      </div>

      <ng-container *ngFor="let budget of budgets">
        <ul class="transactions" *ngIf="(!selectedBudget || budget.id === selectedBudget.id || selectedBudget.id === 0) && budget.transactions && budget.transactions.length">
          <li class="title">{{ budget.category_name }}</li>
          <li *ngFor="let transaction of budget.transactions">
            <div class="details">
              {{ transaction.date | date:'dd/MM' }}
              -
              <strong>{{ transaction.description }}</strong>
              <em *ngIf="transaction.card_name">({{ transaction.card_name }})</em>
            </div>
            <div class="amount">{{ transaction.amount | number:'1.2-2' }}</div>
          </li>
        </ul>
      </ng-container>
    </div>
  </div>
</div>